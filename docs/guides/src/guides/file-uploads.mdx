import { CodeBlock } from '../components/CodeBlock';

# File Uploads: Unleashing the Power of the User

Welcome back, intrepid builder! You've learned how to build applications that are fast, scalable, and real-time. But what if you want to give your users the power to upload their own files? What if you want to build an application that allows users to upload their own photos, videos, or documents? Well, my friend, you've come to the right place. In this section, we're going to learn how to handle file uploads with Effect RPC.

## The Challenge of File Uploads

File uploads can be a tricky business. You have to worry about a lot of things, like file size limits, file type validation, and security. It's a lot to keep track of, and it's easy to make mistakes.

But don't worry, with Effect RPC, handling file uploads is a breeze. We'll be using a library called [formidable](https://github.com/node-formidable/formidable) to handle our file uploads. Formidable is a powerful and flexible library for parsing form data, and it's a perfect match for Effect RPC.

## The Server

To handle file uploads, we'll need to create a new API method on our server. This method will be responsible for parsing the form data and saving the file to the server.

### Creating the upload endpoint

<CodeBlock language="typescript">{`
import { createServer } from 'effect-rpc'
import { api } from './api'
import formidable from 'formidable';
import http from 'http';

const app = createServer({
  api,
  router: {
    // ...
    uploadFile: async ({ req, res }) => {
      const form = formidable({});
      const [fields, files] = await form.parse(req);

      // In a real application, you would save the file to a cloud storage provider
      console.log(files.file[0].filepath);

      return { success: true };
    },
  },
})

const server = http.createServer((req, res) => {
  // You'll need to handle the request with your Effect RPC app
});

server.listen(3000, () => {
  console.log('ðŸš€ Server is ready for uploads on http://localhost:3000')
})
`}</CodeBlock>

In this example, we're creating a new `uploadFile` method that uses formidable to parse the form data. We're then logging the path of the uploaded file to the console. In a real application, you would save the file to a cloud storage provider, like Amazon S3 or Google Cloud Storage.

## The Client

To upload a file from the client, we'll need to create a form that allows the user to select a file. We'll then use the `fetch` API to send the form data to the server.

### Creating the upload form

<CodeBlock language="typescript">{`
import * as React from 'react'

export function FileUpload() {
  const [file, setFile] = React.useState<File | null>(null)

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault()
    if (!file) return

    const formData = new FormData()
    formData.append('file', file)

    await fetch('http://localhost:3000/uploadFile', {
      method: 'POST',
      body: formData,
    })
  }

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="file"
        onChange={(e) => setFile(e.target.files?.[0] ?? null)}
      />
      <button type="submit">Upload</button>
    </form>
  )
}
`}</CodeBlock>

In this example, we're creating a simple form that allows the user to select a file. When the user submits the form, we create a new `FormData` object and append the file to it. We then use the `fetch` API to send the form data to the server.

## The Power is Yours

And that's it! You've learned how to handle file uploads with Effect RPC. You've learned about the challenges of file uploads, and you've learned how to use formidable to parse form data on the server. You're now ready to build applications that allow your users to upload their own files.

The power is yours. So, go out there, build amazing things, and never stop learning. The world is waiting for your next masterpiece.
